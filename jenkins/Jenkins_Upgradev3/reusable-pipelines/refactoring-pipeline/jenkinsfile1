pipeline {
    agent any

    parameters {
      booleanParam(name: 'RELEASE', defaultValue: false, description: 'Is this a RELEASE Candidate?')
    }

    environment {
      VERSION = '0.1.0'
      RELEASE_VERSION = 'R.2'
      ROOT_PATH = 'jenkins/Jenkins_Upgradev3'
    }

    stages {
      stage('Audit tools') {
        steps {
          sh '''
              git version
              java -version
              mvn -version
          '''
        }
      }

      stage('Unit Test') {
        steps {
          dir("./${ROOT_PATH}/java-tomcat-sample") {
            sh '''
              echo "Executing Unit Tests..."
              mvn test
          '''
          }
        }
      }

      stage('Build') {
        steps {
          echo "RELEASE: ${RELEASE}"
          echo "Building version: ${VERSION} with suffix: ${RELEASE_VERSION}"
          echo 'Mention your Application Build Code here!!!'

          dir("./${ROOT_PATH}/java-tomcat-sample") {
            sh '''
              mvn versions:set -DnewVersion="${VERSION}"-SNAPSHOT
              mvn versions:update-child-modules
              mvn clean package
            '''
          }
        }
      }
    }
}
